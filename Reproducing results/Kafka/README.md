Reproducing Results for Kafka
=======
The scripts in this directory can be used to reproduce Kafka results that are presented in paper titled "Toward a Generic Fault Tolerance Technique for Partial Network Partitioning" that is published in OSDI'20. Results in the paper were generated by running the experiments on 20 [xl170](http://docs.cloudlab.us/hardware.html) nodes in Utah cluster on [CloudLab](https://www.cloudlab.us/). The scripts were tested with Python3. 

Prerequisites
-------
1- Install Java.  
```bash
$ apt-get install default-jdk -y
```
2- install kafka v2.13-2.6.0 from the website: https://www.apache.org/dyn/closer.cgi?path=/kafka/2.6.0/kafka_2.13-2.6.0.tgz. 


Running the Experiment
-------
1- Set the following variables in the config.py file: 
* KAFKA_HOME: the directory at which Kafka is installed and it should be the same for all nodes in the cluster.
* NODES_IPS: the ip addresses of all nodes in teh cluster. 
* KAFKA_DATA_DIR: the directory at which Kafka logs and config files will be stored.
* KAFKA_PORT: Kafka brokers will listen at this port
* ZOOKEEPER_PORT: ZooKeeper will listen at this port
* REPLICATION_FACTOR: the replication factor for Kafka. 
* USER_NAME: ssh username which is needed to ssh into other nodes and run commands. Set this to `None` if not needed. 
* SSH_KEY_PATH: the path to ssh private key. Set this to `None` if not needed.

2- start Kafka and ZooKeeper by running  
```bash 
python deploy_kafka.py
```
This script starts a ZooKeeper instance at the first node in `NODES_IPS` and N Kafka brokers on the next N nodes, where N = `REPLICATION_FACTOR`.

3- Run the Kafka benchmark using the script run_benchmark.py. The script takes one argument which specifies the number of clients you'd like to run. The script prints the throughput to the shell. 
```bash 
python run_benchmark.py CLIENTS_COUNT
```

Reproducing Results
-------
In order to reproduce the results in the paper, you have to run the experiment (as described above) with and without Nifty and compare the results. Please refer the `deploy` folder to check how to deploy Nifty.